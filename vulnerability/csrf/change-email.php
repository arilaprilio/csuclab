<?php
include($_SERVER['DOCUMENT_ROOT'].'/lib/loginverify.php');
include($_SERVER['DOCUMENT_ROOT'].'/header.php'); 
include($_SERVER['DOCUMENT_ROOT'].'/config.php'); 

if(!isset($_POST['change']))
{
		$_SESSION['csrf'] = md5(rand());

?>
 CSRF Token diaktifkan untuk halam ini:</br></br>
		Masukkan email baru:<br/><br/>
		<form action="change-email.php" method="POST">
		Email baru: <input type="text" name="email" value=""/>
		<input type="hidden" name="csrf" value="<?php echo $_SESSION['csrf'];?>"/>
		<input type="hidden" name="id" value="<?php echo $_SESSION['userid'];?>"/>
		<br/><br/><input type="submit" name="change" value="Change"/>
		
		</form>
		<br/>
		<?php 
}	
		
		if(isset($_POST['csrf'])&&(strcmp($_POST['csrf'],$_SESSION['csrf'])==0)&&isset($_POST['email'])&&!empty($_POST['email']))
		{
			$email=$_POST['email'];
			$id=$_POST['id'];
			$result= $mysqli->query("Update users set email='$email' where id='$id' ");
			echo "<b style='color:red'>Email diganti !</b>";
			echo "<br/><br/><b><a href='change-email.php'>Kembali ke halaman sebelumnya </a></b>";
		}				 
		
echo "<br/><br/><a href='/myprofile.php?id=".$_SESSION['userid']."'>Kembali ke halaman sebelumnya &gt;&gt;</a>";		
		include($_SERVER['DOCUMENT_ROOT'].'/footer.php'); ?>
<!-- CSRF 2 -->
<!-- Insecure Direct Object Reference 2 -->
